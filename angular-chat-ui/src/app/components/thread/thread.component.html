<div class="thread-container">
  <div class="thread-main">
    <!-- Header -->
    <div *ngIf="chatStarted" class="header">
      <div class="header-content">
        <span class="logo">LG</span>
        <button (click)="onNewThread()" class="title-button">
          Agent Chat
        </button>
      </div>

      <div class="header-actions">
        <button (click)="onNewThread()" class="btn-icon" title="New thread">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
          </svg>
        </button>
        
        <button (click)="onSettings()" class="btn-icon" title="Settings">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Welcome Screen -->
    <div *ngIf="!chatStarted" class="welcome">
      <div class="welcome-content">
        <span class="logo">LG</span>
        <h1 class="welcome-title">Agent Chat</h1>
      </div>
    </div>

    <!-- Messages Area -->
    <div *ngIf="chatStarted" class="messages">
      <div class="messages-container">
        @for (message of streamService.messages(); track trackMessage($index, message)) {
          <app-message 
            [message]="message"
            [isLoading]="streamService.isLoading()"
            [isLastMessage]="$index === streamService.messages().length - 1"
            (regenerate)="onRegenerate($event)"
            (editMessage)="onEditMessage($event)">
          </app-message>
        }
        
        <!-- Loading indicator -->
        <div *ngIf="streamService.isLoading() && !firstTokenReceived()" class="loading-message">
          <div class="avatar">
            <div class="avatar-ai">
              <span class="avatar-text">AI</span>
            </div>
          </div>
          <div class="loading-content">
            <div class="loading-indicator">
              <div class="spinner"></div>
              <span class="loading-text">Thinking...</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="input-area">
      <div class="input-container">
        <form (ngSubmit)="onSubmit()" class="input-form">
          <textarea
            [value]="input()"
            (input)="input.set($any($event.target).value)"
            (keydown)="onKeyDown($event)"
            placeholder="Type your message..."
            class="textarea"
            [disabled]="streamService.isLoading()"
          ></textarea>
          
          <div class="form-actions">
            <button
              *ngIf="streamService.isLoading()"
              type="button"
              (click)="onStop()"
              class="btn-stop"
            >
              <div class="spinner"></div>
              Stop
            </button>
            
            <button
              *ngIf="!streamService.isLoading()"
              type="submit"
              [disabled]="!input().trim()"
              class="btn-send"
            >
              Send
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>