<div class="thread-container">
  <div class="thread-main">
    <!-- Header -->
    <div *ngIf="chatStarted" class="header">
      <div class="header-content">
        <span class="logo">LG</span>
        <button (click)="onNewThread()" class="title-button">
          Agent Chat
        </button>
      </div>

      <div class="header-actions">
        <button (click)="onNewThread()" class="btn-icon" title="New thread">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/>
            <circle cx="12" cy="13" r="3"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Welcome Screen -->
    <div *ngIf="!chatStarted" class="welcome">
      <div class="welcome-content">
        <span class="logo">LG</span>
        <h1 class="welcome-title">Agent Chat</h1>
      </div>
    </div>

    <!-- Messages Area -->
    <div *ngIf="chatStarted" class="messages">
      <div class="messages-container">
        @for (message of streamService.messages(); track trackMessage($index, message)) {
          <app-message 
            [message]="message"
            [isLoading]="streamService.isLoading()"
            (regenerate)="onRegenerate($event)"
          />
        }
        
        <!-- Loading indicator -->
        <div *ngIf="streamService.isLoading() && !firstTokenReceived()" class="loading-message">
          <div class="avatar">
            <div class="avatar-ai">
              <span class="avatar-text">AI</span>
            </div>
          </div>
          <div class="loading-content">
            <div class="loading-indicator">
              <div class="spinner"></div>
              <span class="loading-text">Thinking...</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="input-area">
      <div class="input-container">
        <form (ngSubmit)="onSubmit()" class="input-form">
          <textarea
            [value]="input()"
            (input)="input.set($any($event.target).value)"
            (keydown)="onKeyDown($event)"
            placeholder="Type your message..."
            class="textarea"
            [disabled]="streamService.isLoading()"
          ></textarea>
          
          <div class="form-actions">
            <button
              *ngIf="streamService.isLoading()"
              type="button"
              (click)="onStop()"
              class="btn-stop"
            >
              <div class="spinner"></div>
              Stop
            </button>
            
            <button
              *ngIf="!streamService.isLoading()"
              type="submit"
              [disabled]="!input().trim()"
              class="btn-send"
            >
              Send
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>